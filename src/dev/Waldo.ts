import WebGL from 'gl'
import { AverageSimilarities } from './AverageSimilarities'
import { ComputeSimilarities } from './ComputeSimilarities'
import { ImageData } from './types'

export class Waldo {
  private gl: WebGLRenderingContext
  private computeSimilarities: ComputeSimilarities
  private averageSimilarities: AverageSimilarities

  constructor() {
    this.gl = WebGL(1, 1, { depth: false })
    this.computeSimilarities = new ComputeSimilarities(this.gl)
    this.averageSimilarities = new AverageSimilarities(this.gl)
  }

  public test() {
    // const image: ImageData = {
    //   width: 10,
    //   height: 15,
    //   data: Uint8ClampedArray.from([
    //     255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
    //     255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
    //     255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
    //     255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
    //     255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
    //     255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
    //     255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
    //     255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
    //     255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
    //     255, 255, 255, 255, 0, 0, 0, 255, 255, 255, 255, 255, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
    //     255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
    //     255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
    //     255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
    //     255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
    //     255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
    //   ])
    // }
    // const template: ImageData = {
    //   width: 3,
    //   height: 2,
    //   data: Uint8ClampedArray.from([
    //     0, 0, 0, 255, 255, 255, 255, 255, 0, 0, 0, 255, 
    //     255, 255, 255, 255, 0, 0, 0, 255, 255, 255, 255, 255
    //   ])
    // }
    const image: ImageData = {
      width: 6,
      height: 6,
      data: Uint8ClampedArray.from([
        0, 0, 0, 0,   0, 0, 0, 0,           0, 0, 0, 0,            0, 0, 0, 0,           0, 0, 0, 0,   0, 0, 0, 0,
        0, 0, 0, 0,   255, 255, 255, 255,   255, 255, 255, 255,    255, 255, 255, 255,   0, 0, 0, 0,   0, 0, 0, 0,
        0, 0, 0, 0,   255, 255, 255, 255,   0, 0, 0, 0,            255, 255, 255, 255,   0, 0, 0, 0,   0, 0, 0, 0,
        0, 0, 0, 0,   255, 255, 255, 255,   255, 255, 255, 255,    255, 255, 255, 255,   0, 0, 0, 0,   0, 0, 0, 0,
        0, 0, 0, 0,   0, 0, 0, 0,           0, 0, 0, 0,            0, 0, 0, 0,           0, 0, 0, 0,   0, 0, 0, 0,
        0, 0, 0, 0,   0, 0, 0, 0,           0, 0, 0, 0,            0, 0, 0, 0,           0, 0, 0, 0,   0, 0, 0, 0,
      ])
    }
    
    const template: ImageData = {
      width: 3,
      height: 3,
      data: Uint8ClampedArray.from([
        255, 255, 255, 255,   255, 255, 255, 255,   255, 255, 255, 255,
        255, 255, 255, 255,   0, 0, 0, 0,   255, 255, 255, 255,
        255, 255, 255, 255,   255, 255, 255, 255,   255, 255, 255, 255,
      ])
    }
    const similarities = this.computeSimilarities.run(image, template)
    this.averageSimilarities.run(similarities, template.width, template.height)
  }
}